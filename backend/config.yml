ingestion:
  dedupe_window_seconds: 10
  scan_interval: 5
  pdf_debug: true
  burst_window_seconds: 5

monitoring:
  RULE_MONITORING_HIGH_THRESHOLD: 100
  RULE_MONITORING_LOW_THRESHOLD: 1

anti_noise:
  excluded_families: 
    - "SMAIL"
    - "CONNEXION_OK"
  aggregate_bucket_seconds: 60

zoning:
  inactive_threshold_days: 90

normalization:
  stop_at_first_match: true
  rules:
    # 1. Mise hors service / En service (Operator actions)
    - regex: "MISE HORS SERVICE (\\d{4}) (.*)"
      type: "SERVICE_DISABLE"
      severity: "WARNING"
      extract:
        ticket_code: 1
        actor: 2

    - regex: "MISE EN SERVICE (\\d{4}) (.*)"
      type: "SERVICE_ENABLE"
      severity: "INFO"
      extract:
        ticket_code: 1
        actor: 2

    # 2. Intrusion / Burglary (Generic)
    - regex: "INTRUSION.*ZONE (\\d+|\\$.*)"
      type: "BURGLARY_ALARM"
      severity: "CRITICAL"
      extract:
        zone_label: 1

    - regex: "ALARME INTRUSION.*"
      type: "BURGLARY_ALARM"
      severity: "CRITICAL"

    # 3. Power Issues
    - regex: "DEFAUT SECTEUR.*"
      type: "AC_POWER_FAIL"
      severity: "WARNING"

    - regex: "RETOUR SECTEUR.*"
      type: "AC_POWER_RESTORE"
      severity: "SUCCESS"

    # 4. Battery Issues
    - regex: "DEFAUT BATTERIE.*"
      type: "BATTERY_LOW"
      severity: "WARNING"
      
    - regex: "RETOUR BATTERIE.*"
      type: "BATTERY_RESTORE"
      severity: "SUCCESS"

    # 5. Technical / Supervised
    - regex: "TEST.*"
      type: "TEST_ROUTINE"
      severity: "INFO"

    - regex: "CONNEXION_OK"
      type: "CONNECTION_OK"
      severity: "SUCCESS"
      
    # YPSILON_HISTO RAW CODES
    - regex: ".*\\$(0090|0042|0081|0100|0101|0002|0097).*"
      type: "UNKNOWN_CODE_\\1"
      severity: "INFO"
      extract:
        raw_code: 1

    # 6. Fallback / Generic patterns
    - regex: "ALARM (.*)"
      type: "GENERIC_ALARM"
      severity: "WARNING"
      extract:
        sub_type: 1

# Business Rules V1
business_rules:
  intrusion:
    keywords: ["intrusion", "effraction", "vol", "alarme zone", "alarme perimetrique"]
    maintenance_cancel: true
  absence_test:
    trigger_keywords: ["absence", "no test", "manque test"]
    cancel_keyword: "test cyclique"
  faults:
    apparition_codes: ["710", "711", "750", "301", "302", "304", "342", "343", "07", "383", "137", "144", "145", "330", "796"]
    disparition_suffix: "R"
  ejection:
    code: "570"
    timer_hours: 48
  inhibition:
    keyword: "***"
